<?php
    protected $level3;
    protected $mongator;

    public function __construct(\Level3\Level3 $level3, \Mongator\Mongator $mongator)
    {
        $this->level3 = $level3;
        $this->mongator = $mongator;
    }

    public function registerDefinitions()
    {
{% for class, config in config_classes %}
{% if 'repository' in config.classes|keys %}
        $this->level3->getHub()->registerDefinition(
            '{{ config.key }}', 
            $this->get{{ class|replace({'\\': ''}) }}Repository()
        ); 

{% endif %}
{% endfor %} 
    }

{% for class, config in config_classes %}
{% if 'repository' in config.classes|keys %}
    protected function get{{ class|replace({'\\': ''}) }}Repository($fullClassName)
    {
        $self = $this;

        return function() use ($self) {
            return new \{{ config.classes.repository }}(
                $self->level3,
                $self->mongator
            );
        };
    }
{% endif %}
{% endfor %} 
